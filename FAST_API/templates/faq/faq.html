{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='css/faq.css') }}">
{% endblock %}

{% block content %}
<div class="faq-container">
  <div class="faq-header">
    <h1>FAQ</h1>
    <p>Ivle Malle에 대한 자주 묻는 질문을 모았습니다. 검색창에서 키워드를 입력해서 빠르게 찾아보세요.</p>
  </div>

  <div class="search-container">
    <div class="search-box">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
        <path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
      </svg>
      <input type="text" id="search-input" placeholder="궁금한 내용을 검색해보세요...">
    </div>
  </div>

  <div class="faq-list" id="faq-list">
    {% for item in faq_data %}
    <div class="faq-item" data-question="{{ item.question|lower }}" data-answer="{{ item.answer|lower }}">
      <div class="faq-question" onclick="toggleFAQ(this)">
        <span class="question-text">{{ item.question }}</span>
        <span class="toggle-icon">+</span>
      </div>
      <div class="faq-answer">
        <div class="answer-content">{{ item.answer }}</div>
      </div>
    </div>
    {% endfor %}
  </div>

  <div class="no-results" id="no-results" style="display: none;">
    <div class="no-results-icon">🔍</div>
    <div class="no-results-text">검색 결과가 없습니다</div>
    <div class="no-results-subtext">다른 키워드로 검색해보세요</div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('search-input');
  const faqList = document.getElementById('faq-list');
  const noResults = document.getElementById('no-results');
  const faqItems = document.querySelectorAll('.faq-item');

  // 검색 기능
  searchInput.addEventListener('input', function() {
    const searchTerm = this.value.toLowerCase().trim();
    let visibleCount = 0;

    faqItems.forEach(item => {
      const question = item.dataset.question;
      const answer = item.dataset.answer;
      const isVisible = !searchTerm || question.includes(searchTerm) || answer.includes(searchTerm);
      
      if (isVisible) {
        item.style.display = 'block';
        visibleCount++;
      } else {
        item.style.display = 'none';
      }
    });

    // 검색 결과가 없을 때
    if (searchTerm && visibleCount === 0) {
      noResults.style.display = 'block';
      faqList.style.display = 'none';
    } else {
      noResults.style.display = 'none';
      faqList.style.display = 'block';
    }
  });
});

// FAQ 토글 기능
function toggleFAQ(element) {
  const faqItem = element.parentElement;
  const answer = faqItem.querySelector('.faq-answer');
  const icon = element.querySelector('.toggle-icon');
  
  if (faqItem.classList.contains('active')) {
    faqItem.classList.remove('active');
    answer.style.maxHeight = '0';
    icon.textContent = '+';
  } else {
    faqItem.classList.add('active');
    answer.style.maxHeight = answer.scrollHeight + 'px';
    icon.textContent = '−';
  }
}
</script>
{% endblock %}