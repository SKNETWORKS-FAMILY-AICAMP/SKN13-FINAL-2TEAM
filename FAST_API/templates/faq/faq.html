{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block content %}
<section class="faq-wrap">
  <div class="faq-hero">
    <h1>FAQ</h1>
    <p>Ivle Malle에 대해 자주 묻는 질문을 모았습니다. 찾는 답이 없다면 문의해 주세요.</p>
    <div class="cta">
      <a class="btn-primary btn" href="/contact">문의하기</a>
      <button class="btn" id="expand-all">모두 펼치기</button>
      <button class="btn" id="collapse-all">모두 접기</button>
    </div>

    <div class="faq-tools">
      <div class="searchbar">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/></svg>
        <input id="faq-search" type="text" placeholder="키워드로 검색 (예: 결제, 환불, 추천 품질)" aria-label="FAQ 검색">
      </div>
      <div class="chips" id="faq-chips">
        <span class="chip active" data-cat="all">전체</span>
        <span class="chip" data-cat="account">계정</span>
        <span class="chip" data-cat="recommendation">추천</span>
        <span class="chip" data-cat="order">주문/결제</span>
        <span class="chip" data-cat="returns">반품/환불</span>
        <span class="chip" data-cat="privacy">개인정보</span>
      </div>
    </div>
  </div>

  <div class="faq-accordion" id="faq-list">
    <!-- 샘플 FAQ 항목들 — 필요시 서버에서 반복 렌더 가능 -->
    <div class="faq-item" data-cat="recommendation" id="q-quality">
      <button class="faq-q" aria-expanded="false">
        <span class="q-left">
          <span class="badge-cat">추천</span>
          추천 정확도는 어떻게 높아지나요?
        </span>
        <span class="chev">▶</span>
      </button>
      <div class="faq-a" role="region" aria-labelledby="q-quality">
        <div class="faq-a-inner">
          사용자의 설문, 클릭/저장 이력, 계절/트렌드 데이터를 학습하여 모델이 지속적으로 개선됩니다.
          개인화 신뢰도를 높이려면 <strong>스타일 설문</strong>을 완료하고, 마음에 드는 상품에 <strong>하트</strong> 표시를 해주세요.
        </div>
      </div>
      <div class="faq-footer">
        <span>항목 링크 복사로 공유할 수 있어요.</span>
        <button class="copy-link" data-anchor="#q-quality">링크 복사</button>
      </div>
    </div>

    <div class="faq-item" data-cat="account" id="q-signup">
      <button class="faq-q" aria-expanded="false">
        <span class="q-left">
          <span class="badge-cat">계정</span>
          회원가입 없이도 이용할 수 있나요?
        </span>
        <span class="chev">▶</span>
      </button>
      <div class="faq-a" role="region" aria-labelledby="q-signup">
        <div class="faq-a-inner">
          비회원도 둘러볼 수 있지만, <strong>정확한 추천</strong>과 즐겨찾기/히스토리는 회원에게 제공됩니다.
          <a href="/signup">회원가입</a> 후 더 풍부한 기능을 사용해보세요.
        </div>
      </div>
      <div class="faq-footer">
        <span>계정 문의는 고객센터에서 빠르게 도와드려요.</span>
        <button class="copy-link" data-anchor="#q-signup">링크 복사</button>
      </div>
    </div>

    <div class="faq-item" data-cat="order" id="q-payment">
      <button class="faq-q" aria-expanded="false">
        <span class="q-left">
          <span class="badge-cat">주문/결제</span>
          지원되는 결제 수단은 무엇인가요?
        </span>
        <span class="chev">▶</span>
      </button>
      <div class="faq-a" role="region" aria-labelledby="q-payment">
        <div class="faq-a-inner">
          신용/체크카드, 간편결제(카카오페이/네이버페이) 등을 지원합니다. 일부 결제 수단은 국가에 따라 제한될 수 있어요.
        </div>
      </div>
      <div class="faq-footer">
        <span>결제 오류가 반복될 경우 브라우저 캐시 삭제를 시도해보세요.</span>
        <button class="copy-link" data-anchor="#q-payment">링크 복사</button>
      </div>
    </div>

    <div class="faq-item" data-cat="returns" id="q-return">
      <button class="faq-q" aria-expanded="false">
        <span class="q-left">
          <span class="badge-cat">반품/환불</span>
          반품은 어떻게 진행하나요?
        </span>
        <span class="chev">▶</span>
      </button>
      <div class="faq-a" role="region" aria-labelledby="q-return">
        <div class="faq-a-inner">
          주문 내역에서 반품 신청 후, 택배 수거를 예약해 주세요. 검수 완료 후 환불이 진행됩니다.
          상세 정책은 <a href="/policy/returns">반품 안내</a>에서 확인할 수 있어요.
        </div>
      </div>
      <div class="faq-footer">
        <span>반품 기한과 상태에 따라 추가 비용이 발생할 수 있습니다.</span>
        <button class="copy-link" data-anchor="#q-return">링크 복사</button>
      </div>
    </div>

    <div class="faq-item" data-cat="privacy" id="q-privacy">
      <button class="faq-q" aria-expanded="false">
        <span class="q-left">
          <span class="badge-cat">개인정보</span>
          내 데이터는 어떻게 사용되나요?
        </span>
        <span class="chev">▶</span>
      </button>
      <div class="faq-a" role="region" aria-labelledby="q-privacy">
        <div class="faq-a-inner">
          Ivle Malle은 추천 품질 향상을 위한 최소한의 데이터만 수집·활용합니다.
          자세한 내용은 <a href="/privacy">개인정보 처리방침</a>을 확인하세요.
        </div>
      </div>
      <div class="faq-footer">
        <span>설정에서 개인화 수준을 조절할 수 있어요.</span>
        <button class="copy-link" data-anchor="#q-privacy">링크 복사</button>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block scripts %}
{{ super() }}
<script>
// Accordion, Search, Category chips, Deep-link
document.addEventListener('DOMContentLoaded', function(){
  const list = document.getElementById('faq-list');
  const search = document.getElementById('faq-search');
  const chips = document.getElementById('faq-chips');
  const expandAll = document.getElementById('expand-all');
  const collapseAll = document.getElementById('collapse-all');

  function setOpen(item, open){
    item.classList.toggle('open', open);
    const q = item.querySelector('.faq-q');
    const a = item.querySelector('.faq-a');
    if (q) q.setAttribute('aria-expanded', String(open));
    if (a){
      a.style.maxHeight = open ? (a.scrollHeight + 'px') : '0px';
    }
  }

  // Toggle click
  list.addEventListener('click', function(e){
    const btn = e.target.closest('.faq-q');
    if (!btn) return;
    const item = btn.closest('.faq-item');
    const open = !item.classList.contains('open');
    setOpen(item, open);
  });

  // Search filter
  function filter(){
    const q = (search?.value || '').toLowerCase();
    const activeChip = chips.querySelector('.chip.active');
    const cat = activeChip ? activeChip.dataset.cat : 'all';
    list.querySelectorAll('.faq-item').forEach(item => {
      const matchesCat = (cat === 'all') || item.dataset.cat === cat;
      const text = item.textContent.toLowerCase();
      const matches = matchesCat && (!q || text.includes(q));
      item.style.display = matches ? '' : 'none';
    });
  }
  search?.addEventListener('input', filter);

  // Chips
  chips.addEventListener('click', function(e){
    const chip = e.target.closest('.chip');
    if (!chip) return;
    chips.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
    chip.classList.add('active');
    filter();
  });

  // Expand/Collapse all (visible only)
  expandAll?.addEventListener('click', function(){
    list.querySelectorAll('.faq-item').forEach(item => {
      if (item.style.display !== 'none') setOpen(item, true);
    });
  });
  collapseAll?.addEventListener('click', function(){
    list.querySelectorAll('.faq-item').forEach(item => setOpen(item, false));
  });

  // Deep-link open if hash exists
  if (location.hash){
    const target = document.querySelector(location.hash);
    if (target && target.classList.contains('faq-item')){
      setOpen(target, true);
      target.scrollIntoView({behavior:'smooth', block:'start'});
    }
  }

  // Copy link buttons
  list.addEventListener('click', function(e){
    const btn = e.target.closest('.copy-link');
    if (!btn) return;
    const anchor = btn.dataset.anchor || '';
    const url = location.origin + location.pathname + anchor;
    navigator.clipboard.writeText(url).then(()=>{
      btn.textContent = '복사됨!';
      setTimeout(()=> btn.textContent = '링크 복사', 1200);
    });
  });

  // Initial
  filter();
});
</script>
{% endblock %}
