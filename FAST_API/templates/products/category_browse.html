{% extends "base.html" %}

{% block head %}
{% endblock %}

{% block content %}
<section class="category-page">
  <!-- 필터 사이드바 -->
  <aside class="filter-sidebar">
    <h2>필터</h2>

    <!-- 성별 필터 -->
    <div class="filter-section">
        <h3>성별</h3>
        <div class="filter-options">
            <label class="filter-option">
                <input type="checkbox" name="gender" value="male" class="filter-checkbox"
                       {% if request.query_params.get('gender', '').find('male') != -1 %}checked{% endif %}>
                <span class="checkmark"></span>
                남성
            </label>
            <label class="filter-option">
                <input type="checkbox" name="gender" value="female" class="filter-checkbox"
                       {% if request.query_params.get('gender', '').find('female') != -1 %}checked{% endif %}>
                <span class="checkmark"></span>
                여성
            </label>
            <label class="filter-option">
                <input type="checkbox" name="gender" value="unisex" class="filter-checkbox"
                       {% if request.query_params.get('gender', '').find('unisex') != -1 %}checked{% endif %}>
                <span class="checkmark"></span>
                공용
            </label>
        </div>
    </div>

    <!-- 의류 타입 필터 -->
    <div class="filter-section">
        <h3>의류 타입</h3>
        <div class="filter-options">
            <label class="filter-option">
                <input type="checkbox" name="clothing_type" value="top" class="filter-checkbox"
                       {% if request.query_params.get('clothing_type', '').find('top') != -1 %}checked{% endif %}>
                <span class="checkmark"></span>
                상의
            </label>
            <label class="filter-option">
                <input type="checkbox" name="clothing_type" value="bottom" class="filter-checkbox"
                       {% if request.query_params.get('clothing_type', '').find('bottom') != -1 %}checked{% endif %}>
                <span class="checkmark"></span>
                하의
            </label>
            <label class="filter-option">
                <input type="checkbox" name="clothing_type" value="skirt" class="filter-checkbox"
                       {% if request.query_params.get('clothing_type', '').find('skirt') != -1 %}checked{% endif %}>
                <span class="checkmark"></span>
                스커트
            </label>
        </div>
    </div>

    <!-- 가격 필터 -->
    <div class="filter-section">
        <h3>가격 범위</h3>
        <div class="price-filter">
            <div class="price-inputs">
                <input type="number" id="min-price" placeholder="최소가격" class="price-input" 
                       value="{{ request.query_params.get('min_price', '') }}">
                <span class="price-separator">~</span>
                <input type="number" id="max-price" placeholder="최대가격" class="price-input"
                       value="{{ request.query_params.get('max_price', '') }}">
            </div>
            <div class="price-buttons">
                <button class="price-btn" data-min="0" data-max="30000">3만원 이하</button>
                <button class="price-btn" data-min="30000" data-max="50000">3-5만원</button>
                <button class="price-btn" data-min="50000" data-max="100000">5-10만원</button>
                <button class="price-btn" data-min="100000" data-max="999999">10만원 이상</button>
            </div>
        </div>
    </div>

    <!-- 필터 초기화 -->
    <div class="filter-actions">
        <button id="clear-filters" class="clear-btn">필터 초기화</button>
        <button id="apply-filters" class="apply-btn">필터 적용</button>
    </div>
  </aside>

  <!-- 상품 목록 섹션 -->
  <main class="product-listing-area">
    <div class="listing-header">
        <h1>상품 목록</h1>
        <div class="sort-options">
            <select id="sort-select" class="sort-select">
                <option value="default" {% if request.query_params.get('sort') == 'default' or not request.query_params.get('sort') %}selected{% endif %}>기본순</option>
                <option value="price-low" {% if request.query_params.get('sort') == 'price-low' %}selected{% endif %}>가격 낮은순</option>
                <option value="price-high" {% if request.query_params.get('sort') == 'price-high' %}selected{% endif %}>가격 높은순</option>
                <option value="name" {% if request.query_params.get('sort') == 'name' %}selected{% endif %}>이름순</option>
            </select>
        </div>
    </div>

    <!-- 상품 그리드 -->
    <div class="product-grid" id="product-grid">
        {% for product in products %}
        <div class="product-card" 
             data-product-id="{{ product.get('상품코드', '') }}"
             data-product-name="{{ product.get('상품명', '') }}"
             data-product-brand="{{ product.get('한글브랜드명', '') }}"
             data-product-category="{{ product.get('대분류', '') }}"
             data-product-subcategory="{{ product.get('소분류', '') }}"
             data-product-color="{{ product.get('색상', '') }}"
             data-product-price="{{ product.get('원가', '0') }}"
             data-product-image="{{ product.get('이미지URL', product.get('대표이미지URL', '')) }}"
             data-product-link="{{ product.get('상품링크', '') }}"
             data-type="{{ product.get('의류타입', product.get('대분류', '')) }}">
            <img src="{{ product.get('이미지URL', product.get('대표이미지URL', '')) }}" 
                 alt="{{ product.get('상품명', '') }}"
                 title="{{ product.get('상품명', '') }}: {{ product.get('한글브랜드명', '') }}">

        </div>
        {% endfor %}
    </div>

    <!-- 결과 없음 메시지 -->
    <div id="no-results" class="no-results" style="display: none;">
        <p>조건에 맞는 상품이 없습니다.</p>
    </div>

    <!-- 페이지네이션 -->
    {% if total_pages > 1 %}
    <div class="pagination-container">
        <div class="pagination-info">
            <span>총 {{ total_products }}개 상품 중 {{ (current_page - 1) * items_per_page + 1 }}-{{ [current_page * items_per_page, total_products] | min }}개 표시</span>
        </div>
        <div class="pagination">
            {% if current_page > 1 %}
                <a href="?page=1{% for key, value in current_filters.items() %}&{{ key }}={{ value }}{% endfor %}" class="page-link">« 처음</a>
                <a href="?page={{ current_page - 1 }}{% for key, value in current_filters.items() %}&{{ key }}={{ value }}{% endfor %}" class="page-link">‹ 이전</a>
            {% endif %}
            
            {% for page_num in range([1, current_page - 2] | max, [current_page + 3, total_pages + 1] | min) %}
                {% if page_num == current_page %}
                    <span class="page-link current">{{ page_num }}</span>
                {% else %}
                    <a href="?page={{ page_num }}{% for key, value in current_filters.items() %}&{{ key }}={{ value }}{% endfor %}" class="page-link">{{ page_num }}</a>
                {% endif %}
            {% endfor %}
            
            {% if current_page < total_pages %}
                <a href="?page={{ current_page + 1 }}{% for key, value in current_filters.items() %}&{{ key }}={{ value }}{% endfor %}" class="page-link">다음 ›</a>
                <a href="?page={{ total_pages }}{% for key, value in current_filters.items() %}&{{ key }}={{ value }}{% endfor %}" class="page-link">마지막 »</a>
            {% endif %}
        </div>
    </div>
    {% endif %}
  </main>
</section>

<!-- 제품 상세 모달 -->
<div id="product-modal" class="modal">
  <div class="modal-content">
    <div class="modal-header">
      <h3>상품 상세 정보</h3>
      <button id="close-modal">&times;</button>
    </div>
    <div id="product-details" class="modal-body">
      <!-- 상품 상세 정보가 여기에 표시됩니다 -->
    </div>
  </div>
</div>
{% endblock %}

{% block scripts %}
{{ super() }}
<script src="/static/js/filters.js"></script>
{% endblock %}