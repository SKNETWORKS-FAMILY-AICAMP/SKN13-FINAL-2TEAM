{% extends "base.html" %}

{% block content %}
    <div class="netflix-home">
<!-- Hero Section -->
<section class="hero-section">
<div aria-hidden="true" class="hero-blob"></div>
<div class="hero-split-left reveal">
<div class="hero-eyebrow">Personalized Outfit Engine</div>
<h1 class="hero-title">Ivle Malle</h1>
<p class="hero-sub">ë‹¹ì‹ ì˜ ì·¨í–¥, ì²´í˜•, ê³„ì ˆ ì»¬ëŸ¬ë¥¼ ì´í•´í•˜ëŠ” AIê°€
        ì˜¤ëŠ˜ ì…ì„ ì´ìœ ë¥¼ ë””ìì¸í•©ë‹ˆë‹¤. í•œ ë²ˆì˜ í´ë¦­ìœ¼ë¡œ ì™„ì„±í˜• ì½”ë”” ì œì•ˆ.</p>
<div class="hero-cta">
<button class="btn-glass btn-primary">ì§€ê¸ˆ ì¶”ì²œ ë°›ê¸°</button>
<button class="btn-glass">ìŠ¤íƒ€ì¼ ì„¤ë¬¸</button>
<button class="btn-glass">ë£©ë¶ ë³´ê¸°</button>
</div>
<div aria-hidden="true" class="brand-ticker">
<div class="brand-track">
<span>Maison</span><span>Archive</span><span>Ivle Malle</span><span>Tailored</span><span>Minimal</span><span>Street</span>
<span>Maison</span><span>Archive</span><span>Ivle Malle</span><span>Tailored</span><span>Minimal</span><span>Street</span>
</div>
</div>
</div>
<div class="hero-split-right reveal">
    <div class="hero-portrait-carousel">
        <img src="{{ url_for('static', path='img/ë£©ë¶1.webp') }}" alt="Lookbook 1" class="lookbook-image">
        <img src="{{ url_for('static', path='img/ë£©ë¶2.webp') }}" alt="Lookbook 2" class="lookbook-image">
        <img src="{{ url_for('static', path='img/ë£©ë¶3.webp') }}" alt="Lookbook 3" class="lookbook-image">
        <img src="{{ url_for('static', path='img/ë£©ë¶4.webp') }}" alt="Lookbook 4" class="lookbook-image">
        <img src="{{ url_for('static', path='img/ë£©ë¶5.webp') }}" alt="Lookbook 5" class="lookbook-image">
    </div>
</div>
</section>
<!-- Content Rows -->
        {% for section_title, section_items in [
            ("USER_CONTENT_TITLE", section1_items),
            ("ì§€ê¸ˆ ëœ¨ëŠ” ì½˜í…ì¸ ", section2_items),
            ("ìƒˆë¡œ ì¶”ê°€ëœ ì½˜í…ì¸ ", section3_items),
            ("ì¶”ê°€ ì¶”ì²œ ì½˜í…ì¸ ", section4_items)
        ] %}
        <section class="content-row">
        {% if section_title == "USER_CONTENT_TITLE" %}
            <h2>{{ request.session.user_name }}ë‹˜ì´ ì¢‹ì•„í•  ë§Œí•œ ì½˜í…ì¸ </h2>
        {% else %}
            <h2>{{ section_title }}</h2>
        {% endif %}
<div class="scroll-container">
<div class="scroll-arrow left">â®</div>
<div class="row-posters">
                    {% for item in section_items %}
                                         <div style="position: relative; display: inline-block; cursor: pointer;" 
                          class="home-product-card" 
                          data-product-id="{{ item.get('ìƒí’ˆì½”ë“œ') }}"
                          data-product-name="{{ item.get('ì œí’ˆì´ë¦„') }}"
                          data-product-brand="{{ item.get('ë¸Œëœë“œ') or item.get('í•œê¸€ë¸Œëœë“œëª…') }}"
                          data-product-category="{{ item.get('ëŒ€ë¶„ë¥˜') }}"
                          data-product-subcategory="{{ item.get('ì†Œë¶„ë¥˜') }}"
                          data-product-color="{{ item.get('ìƒ‰ìƒ') }}"
                          data-product-price="{{ item.get('ì›ê°€') }}"
                          data-product-image="{{ item.get('ì‚¬ì§„') }}"
                          data-product-link="{{ item.get('ìƒí’ˆë§í¬') }}">
                        <img alt="{{ item['ì œí’ˆì´ë¦„'] }}" src="{{ item['ì‚¬ì§„'] }}" title="{{ item['ì œí’ˆì´ë¦„'] }}: {{ item['ë¸Œëœë“œ'] }}"/>
                        {% if item.get('jjim_count', 0) > 0 %}
                        <div style="position: absolute; top: 10px; right: 10px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: bold; display: flex; align-items: center; gap: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                            <span style="font-size: 10px;">â¤ï¸</span>
                            <span style="font-size: 11px;">{{ item['jjim_count'] }}</span>
                        </div>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
<div class="scroll-arrow right">â¯</div>
</div>
</section>
        {% endfor %}
    </div>

<!-- ë””ë²„ê¹…: ì²« ë²ˆì§¸ ìƒí’ˆ ë°ì´í„° í™•ì¸ -->
{% if section1_items %}
<div style="background:#f0f0f0; padding:20px; margin:20px 0; border-radius:8px; font-family:monospace; font-size:12px;" id="debug-info">
    <h4>ğŸ” í™ˆí™”ë©´ ë””ë²„ê¹… ì •ë³´ (ì²« ë²ˆì§¸ ìƒí’ˆ)</h4>
    ìƒí’ˆì½”ë“œ: {{ section1_items[0].get('ìƒí’ˆì½”ë“œ', 'ì—†ìŒ') }}<br>
    ì œí’ˆì´ë¦„: {{ section1_items[0].get('ì œí’ˆì´ë¦„', 'ì—†ìŒ') }}<br>
    ìƒí’ˆëª…: {{ section1_items[0].get('ìƒí’ˆëª…', 'ì—†ìŒ') }}<br>
    ë¸Œëœë“œ: {{ section1_items[0].get('ë¸Œëœë“œ', 'ì—†ìŒ') }}<br>
    í•œê¸€ë¸Œëœë“œëª…: {{ section1_items[0].get('í•œê¸€ë¸Œëœë“œëª…', 'ì—†ìŒ') }}<br>
    ëŒ€ë¶„ë¥˜: {{ section1_items[0].get('ëŒ€ë¶„ë¥˜', 'ì—†ìŒ') }}<br>
    ì†Œë¶„ë¥˜: {{ section1_items[0].get('ì†Œë¶„ë¥˜', 'ì—†ìŒ') }}<br>
    ì›ê°€: {{ section1_items[0].get('ì›ê°€', 'ì—†ìŒ') }}<br>
    í• ì¸ê°€: {{ section1_items[0].get('í• ì¸ê°€', 'ì—†ìŒ') }}<br>
    ì„±ë³„: {{ section1_items[0].get('ì„±ë³„', 'ì—†ìŒ') }}<br>
    ì‚¬ì§„: {{ section1_items[0].get('ì‚¬ì§„', 'ì—†ìŒ') }}<br>
    ì´ë¯¸ì§€URL: {{ section1_items[0].get('ì´ë¯¸ì§€URL', 'ì—†ìŒ') }}<br>
    ëŒ€í‘œì´ë¯¸ì§€URL: {{ section1_items[0].get('ëŒ€í‘œì´ë¯¸ì§€URL', 'ì—†ìŒ') }}<br>
    ì†Œì¬: {{ section1_items[0].get('ì†Œì¬', 'ì—†ìŒ') }}<br>
    ìƒ‰ìƒ: {{ section1_items[0].get('ìƒ‰ìƒ', 'ì—†ìŒ') }}<br>
    ì¢‹ì•„ìš”ìˆ˜: {{ section1_items[0].get('ì¢‹ì•„ìš”ìˆ˜', 'ì—†ìŒ') }}<br>
    ìƒí’ˆë§í¬: {{ section1_items[0].get('ìƒí’ˆë§í¬', 'ì—†ìŒ') }}<br>
    ì˜ì–´ë¸Œëœë“œëª…: {{ section1_items[0].get('ì˜ì–´ë¸Œëœë“œëª…', 'ì—†ìŒ') }}<br>
    <br>
    <strong>ì „ì²´ ë°ì´í„° í‚¤:</strong><br>
    {% for key, value in section1_items[0].items() %}
    {{ key }}: {{ value }}<br>
    {% endfor %}
</div>
<script>
    console.log('Home Debug info:', document.getElementById('debug-info').innerHTML);
</script>
{% endif %}

<!-- Product Detail Modal -->
<div id="homeProductModal" class="modal" style="position:fixed; inset:0; background:rgba(0,0,0,0.5); display:none; align-items:center; justify-content:center; z-index:1000;">
  <div style="background:#fff; padding:20px; width:90%; max-width:500px; border-radius:8px; max-height:90vh; overflow:auto;">
         <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
       <h3 style="margin:0; color:#333; font-weight:600;">ìƒí’ˆ ìƒì„¸ ì •ë³´</h3>
       <button id="closeHomeProductModal" style="background:none; border:none; font-size:24px; cursor:pointer;">&times;</button>
     </div>
    <div id="homeProductDetails">
      <!-- ìƒí’ˆ ìƒì„¸ ì •ë³´ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>
  </div>
</div>

<!-- GSAP Animation Script -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        // ë¡œê³  ë“±ì¥ íš¨ê³¼ (fromì„ ì‚¬ìš©í•˜ì—¬ ì‹œì‘ ìƒíƒœë¥¼ ì •ì˜)
        gsap.from(".logo-container .logo", {
            opacity: 0,
            y: -100, // ì‹œì‘ Y ìœ„ì¹˜ë¥¼ -100pxë¡œ ì„¤ì •
            duration: 1.2,
            ease: "power2.out",
            delay: 0.2
        });

        // Hero Section ë“±ì¥ íš¨ê³¼ (ë¡œê³  ë“±ì¥ í›„ ë“±ì¥í•˜ë„ë¡ ë”œë ˆì´ ì¶”ê°€)
        gsap.to(".hero-content", { 
            opacity: 1, 
            y: 0, 
            duration: 1.2,
            ease: "power2.out",
            delay: 0.8
        });

        // ì½˜í…ì¸  row ë“±ì¥ íš¨ê³¼
        gsap.utils.toArray(".content-row").forEach(function(section) {
            gsap.to(section, {
                scrollTrigger: {
                    trigger: section,
                    start: "top 80%",
                    end: "bottom 20%",
                    toggleActions: "play none none none"
                },
                opacity: 1,
                y: 0,
                duration: 0.8,
                ease: "power1.out"
            });
        });

        // ì´ë¯¸ì§€ hover íš¨ê³¼
        const posters = document.querySelectorAll('.row-posters img');
        posters.forEach(img => {
            img.addEventListener('mouseenter', () => {
                gsap.to(img, { scale: 1.08, duration: 0.3 });
            });
            img.addEventListener('mouseleave', () => {
                gsap.to(img, { scale: 1.0, duration: 0.3 });
            });
        });

        // í™”ì‚´í‘œ í´ë¦­ ìŠ¤í¬ë¡¤ íš¨ê³¼
        document.querySelectorAll('.scroll-container').forEach(container => {
            const leftArrow = container.querySelector('.scroll-arrow.left');
            const rightArrow = container.querySelector('.scroll-arrow.right');
            const posterContainer = container.querySelector('.row-posters');

            leftArrow.addEventListener('click', () => {
                gsap.to(posterContainer, {scrollTo: {x: "-=600"}, duration: 0.8, ease: "power1.out"});
            });
            rightArrow.addEventListener('click', () => {
                gsap.to(posterContainer, {scrollTo: {x: "+=600"}, duration: 0.8, ease: "power1.out"});
            });
        });

        // Hero Image Carousel Logic
        const lookbookImages = gsap.utils.toArray('.lookbook-image');
        if (lookbookImages.length > 0) {
            let currentIndex = 0;
            const intervalTime = 4000; // 4 seconds

            // Initially, set all but the first image to be hidden
            gsap.set(lookbookImages.slice(1), { autoAlpha: 0 });

            function showNextImage() {
                const lastIndex = currentIndex;
                currentIndex = (currentIndex + 1) % lookbookImages.length;

                gsap.to(lookbookImages[lastIndex], { autoAlpha: 0, duration: 1.2, ease: 'power1.inOut' });
                gsap.to(lookbookImages[currentIndex], { autoAlpha: 1, duration: 1.2, ease: 'power1.inOut' });
            }

            setInterval(showNextImage, intervalTime);
        }

        // ìƒí’ˆ ìƒì„¸ ëª¨ë‹¬ ê¸°ëŠ¥
        const homeProductModal = document.getElementById('homeProductModal');
        const closeHomeProductBtn = document.getElementById('closeHomeProductModal');
        const homeProductDetails = document.getElementById('homeProductDetails');

        function openHomeProductModal() { 
            homeProductModal.style.display = 'flex'; 
        }
        function closeHomeProductModal() { 
            homeProductModal.style.display = 'none'; 
        }

                 function loadHomeProductDetails(productCard) {
             const productId = productCard.getAttribute('data-product-id');
             const productName = productCard.getAttribute('data-product-name');
             const productBrand = productCard.getAttribute('data-product-brand');
             const productCategory = productCard.getAttribute('data-product-category');
             const productSubcategory = productCard.getAttribute('data-product-subcategory');
             const productColor = productCard.getAttribute('data-product-color');
             const productPrice = productCard.getAttribute('data-product-price');
             const productImage = productCard.getAttribute('data-product-image');
             const productLink = productCard.getAttribute('data-product-link');

             // ê°€ê²© í¬ë§·íŒ… í•¨ìˆ˜
             function formatPrice(price) {
                 if (!price || price === 'N/A') return 'N/A';
                 const numPrice = parseInt(price);
                 if (isNaN(numPrice)) return price;
                 return numPrice.toLocaleString('ko-KR') + 'ì›';
             }

             homeProductDetails.innerHTML = `
                 <div style="display:flex; gap:20px; margin-bottom:20px;">
                     <img src="${productImage || 'https://via.placeholder.com/200'}" 
                          alt="${productName}" 
                          style="width:200px; height:200px; object-fit:cover; border-radius:8px;">
                     <div style="flex:1;">
                         <h4 style="margin:0 0 15px 0; color:#333; font-size:18px; font-weight:600;">${productName}</h4>
                         <div style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px;">
                             <p style="margin:8px 0; color:#333; font-size:14px;"><strong style="color:#2c3e50;">ë¸Œëœë“œ:</strong> <span style="color:#34495e;">${productBrand || 'N/A'}</span></p>
                             <p style="margin:8px 0; color:#333; font-size:14px;"><strong style="color:#2c3e50;">ì¹´í…Œê³ ë¦¬:</strong> <span style="color:#34495e;">${productCategory || 'N/A'} > ${productSubcategory || 'N/A'}</span></p>
                             <p style="margin:8px 0; color:#333; font-size:14px;"><strong style="color:#2c3e50;">ìƒ‰ìƒ:</strong> <span style="color:#34495e;">${productColor || 'N/A'}</span></p>
                             <p style="margin:8px 0; color:#333; font-size:14px;"><strong style="color:#2c3e50;">ê°€ê²©:</strong> <span style="color:#e74c3c; font-weight:600; font-size:16px;">${formatPrice(productPrice)}</span></p>
                         </div>
                         ${productLink ? `<a href="${productLink}" target="_blank" style="display:inline-block; margin-top:10px; padding:12px 20px; background:linear-gradient(135deg, #3498db, #2980b9); color:#fff; text-decoration:none; border-radius:6px; font-weight:600; box-shadow:0 2px 8px rgba(52,152,219,0.3); transition:all 0.3s ease;">ìƒí’ˆ ë³´ê¸°</a>` : ''}
                     </div>
                 </div>
             `;
         }

        // ìƒí’ˆ ì¹´ë“œ í´ë¦­ ì´ë²¤íŠ¸
        document.addEventListener('click', (e) => {
            const productCard = e.target.closest('.home-product-card');
            if (productCard) {
                loadHomeProductDetails(productCard);
                openHomeProductModal();
            }
        });

        closeHomeProductBtn.addEventListener('click', closeHomeProductModal);
        homeProductModal.addEventListener('click', (e) => { 
            if (e.target === homeProductModal) closeHomeProductModal(); 
        });
    });

    </script>

    <script>
      // Reveal on scroll
      const io = new IntersectionObserver((entries)=>{
        entries.forEach(e=>{
          if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target); }
        });
      }, {threshold: .12, rootMargin: '0px 0px -40px 0px'});
      document.querySelectorAll('.reveal, .row').forEach(el=> io.observe(el));
    </script>

{% endblock %}
