{% extends "base.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', path='css/jjim.css') }}">
{% endblock %}

{% block content %}
<div class="jjim-container">
    <!-- Top Wishlist Grid -->
    <div class="wishlist-grid">
        <h1>찜 목록</h1>
        <div class="product-grid">
            {% for product in jjim_products %}
            <div class="product-card" data-product-id="{{ loop.index }}">
                <img src="{{ product['대표이미지URL'] }}" alt="{{ product['상품명'] }}">
                <div class="product-card-info">
                    <h3>{{ product['상품명'] }}</h3>
                </div>
                <!-- Hidden full data for comparison -->
                <div class="product-full-data" style="display: none;">
                    <h3>{{ product['상품명'] }}</h3>
                    <p><strong>브랜드:</strong> {{ product['브랜드'] }}</p>
                    <p><strong>소재:</strong> {{ product['소재'] }}</p>
                    <p><strong>가격:</strong> {{ product['가격'] }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Bottom Comparison Panel -->
    <div class="comparison-panel">
        <div class="comparison-slot" id="slot-1"><span>상품 1을 선택하세요</span></div>
        <div class="vs-icon" id="vs-icon">VS</div>
        <div class="comparison-slot" id="slot-2"><span>상품 2를 선택하세요</span></div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const grid = document.querySelector('.product-grid');
    const slots = Array.from(document.querySelectorAll('.comparison-slot'));
    const vsIcon = document.getElementById('vs-icon');

    // A single, reliable click handler on the container
    document.querySelector('.jjim-container').addEventListener('click', e => {
        const card = e.target.closest('.product-card');
        if (!card) return;

        // Decide where the card should go
        const isSelected = card.classList.contains('in-slot');
        let targetParent = null;

        if (isSelected) {
            // If selected, target is the main grid
            targetParent = grid;
        } else {
            // If not selected, target is the first empty slot
            targetParent = slots.find(slot => !slot.querySelector('.product-card'));
        }

        // If a valid target was found, move the card
        if (targetParent) {
            if (targetParent.classList.contains('comparison-slot') && targetParent.children.length > 0) {
                targetParent.innerHTML = ''; // Clear placeholder text
            }
            
            // Move the card and toggle its state class
            targetParent.appendChild(card);
            card.classList.toggle('in-slot');

            // No animation, just update the UI directly
            updateUI();
        }
    });

    function updateUI() {
        slots.forEach((slot, index) => {
            const hasCard = slot.querySelector('.product-card');
            slot.classList.toggle('filled', hasCard);
            // Restore placeholder if the slot is now empty
            if (!hasCard) {
                slot.innerHTML = `<span>상품 ${index + 1}을 선택하세요</span>`;
            }
        });

        // Update the VS icon visibility
        const filledCount = document.querySelectorAll('.comparison-slot.filled').length;
        vsIcon.classList.toggle('visible', filledCount === 2);
    }
});
</script>
{% endblock %}
